define(function(){"use strict";function n(){function n(n){return{emit(e,o){const r=t(n),c=r[e],i=r["*"];if(c)for(const t of c)t(o,n);if(i)for(const t of i)t(o,e,n)},clear(t){const e=r.get(n);e&&(t&&r.delete(n),o(e))}}}function t(n,t){if(null==n)throw new TypeError("Invalid topic");let o=r.get(n);if(void 0===o){const t=c.get(n);void 0!==t?o=t.ns||(t.ns=e()):r.set(n,o=e())}return t?o[t]||(o[t]=[]):o}function e(){return Object.create(null)}function o(n){for(const[t,e]of Object.entries(n)){delete n[t];for(const n of e)n.fn=n.lst=null}}const r=new Map,c=new WeakMap;return{topic:n,sink:function(e){function r(n,o,i){if("function"!=typeof i)throw new TypeError("Expected function");let f=c.get(e);if(void 0===f&&(f=new Set,c.set(e,f)),n){const e=t(n,o);f.add({fn:i,lst:e}),e.push(i)}return r}return Object.assign(r,{subscribe:r,clear:function(){const n=c.get(e);if(n){c.delete(e);for(const{lst:t,fn:e}of n)t&&t.splice(t.indexOf(e)>>>0,1);n.clear(),n.ns&&o(n.ns)}return r},on:function(n,t){return r(e,n,t)},emit:function(t,o){const i=c.get(e);return i&&i.ns&&n(e).emit(t,o),r}})}}}return Object.assign(n,n()),n});
