define(["exports"],function(t){"use strict";function n(){function t(t){return{emit(e,s){const o=n(t),i=o[e],r=o["*"];if(i)for(const n of i)n(s,t);if(r)for(const n of r)n(s,e,t)},clear(n){const e=o.get(t);e&&(n&&o.delete(t),s(e))}}}function n(t,n){if(null==t)throw new TypeError("Invalid topic");let s=o.get(t);if(void 0===s){const n=i.get(t);void 0!==n?s=n.ns||(n.ns=e()):o.set(t,s=e())}return n?s[n]||(s[n]=[]):s}function e(){return Object.create(null)}function s(t){for(const[n,e]of Object.entries(t)){delete t[n];for(const t of e)t.fn=t.lst=null}}const o=new Map,i=new WeakMap;return{topic:t,sink:function(e){function o(t,s,r){if("function"!=typeof r)throw new TypeError("Expected function");let c=i.get(e);if(void 0===c&&(c=new Set,i.set(e,c)),t){const e=n(t,s);c.add({fn:r,lst:e}),e.push(r)}return o}return Object.assign(o,{subscribe:o,clear:function(){const t=i.get(e);if(t){i.delete(e);for(const{lst:n,fn:e}of t)n&&n.splice(n.indexOf(e)>>>0,1);t.clear(),t.ns&&s(t.ns)}return o},on:function(t,n){return o(e,t,n)},emit:function(n,s){const r=i.get(e);return r&&r.ns&&t(e).emit(n,s),o}})}}}function e(t){const n="function"==typeof t.subscriptions?t.subscriptions(t.props):t.subscriptions;if(null==n)return;const e={},s=[];let o=null;for(const[i,r]of Object.entries(n)){if(null==r||"function"!=typeof r.subscribe)throw new TypeError(`Subscription "${i}" does not have a subscribe() function`);s.push(r.subscribe(n=>{e[i]=n,null===o&&(o=Promise.resolve().then(()=>{t.setSubscriptionState(e),o=null}))}))}t.setSubscriptionState(e,function(){for(const t of s.splice(0,s.length))t()})}Object.assign(n,n()),t.evtbus=n,t.default=n,t.withSubscribe=function(t,n){const s=class extends n{constructor(...t){var n;return n=super(...t),this.state=this.state||{},n}subscriptions(t){}setSubscriptionState(t,n){void 0!==n?(Object.assign(this.state,t),this.evt_sink.on("cleanup",n)):this.setState(t)}componentWillMount(){e(this)}componentWillUnmount(...t){this.evt_sink.emit("cleanup").clear()}get evt_sink(){return t.sink(this)}};return s.prototype.evtbus=t,s},t.bindSubscriptions=e,Object.defineProperty(t,"__esModule",{value:!0})});
