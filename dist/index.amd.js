define(["exports"],function(t){"use strict";function n(){function t(t){return{emit(e,o){const i=n(t),s=i[e],r=i["*"];if(s)for(const n of s)n(o,t);if(r)for(const n of r)n(o,e,t)},clear(n){const e=i.get(t);e&&(n&&i.delete(t),o(e))}}}function n(t,n){if(null==t)throw new TypeError("Invalid topic");let o=i.get(t);if(void 0===o){const n=s.get(t);void 0!==n?o=n.ns||(n.ns=e()):i.set(t,o=e())}return n?o[n]||(o[n]=[]):o}function e(){return Object.create(null)}function o(t){for(const[n,e]of Object.entries(t)){delete t[n];for(const t of e)t.fn=t.lst=null}}const i=new Map,s=new WeakMap;return{topic:t,sink:function(e){function i(t,o,r){if("function"!=typeof r)throw new TypeError("Expected function");let c=s.get(e);if(void 0===c&&(c=new Set,s.set(e,c)),t){const e=n(t,o);c.add({fn:r,lst:e}),e.push(r)}return i}return Object.assign(i,{subscribe:i,clear:function(){const t=s.get(e);if(t){s.delete(e);for(const{lst:n,fn:e}of t)n&&n.splice(n.indexOf(e)>>>0,1);t.clear(),t.ns&&o(t.ns)}return i},on:function(t,n){return i(e,t,n)},emit:function(n,o){const r=s.get(e);return r&&r.ns&&t(e).emit(n,o),i}})}}}function e(t,n){if("function"!=typeof n){if(Array.isArray(n))return n.map(n=>e(t,n));{const o={};for(const[i,s]of Object.entries(n))"function"==typeof s&&(o[i]=e(t,s));return o}}const i=class extends n{subscribe(t){}componentWillMount(){super.componentWillMount(),o(this),this.evt_sink.emit("will_mount")}componentDidMount(){this.evt_sink.emit("did_mount")}componentWillUnmount(){this.evt_sink.emit("will_unmount").clear()}get evt_sink(){return t.sink(this)}};return i.prototype.evtbus=t,i}function o(t,n){null==t.state&&(t.state={});const e=[];t.evt_sink.on("will_mount",function(){const o=n?n.call(t,t.props,t):t.subscribe(t.props);t.setState(o,function(){for(const[n,i]of Object.entries(o)){if(null==i||"function"!=typeof i.subscribe)throw new TypeError(`Subscription "${n}" does not have a subscribe() function`);e.push(i.subscribe(!1,e=>{t.setState(t=>e!==t[n]?{[n]:e}:null)}))}})}).on("will_unmount",function(){for(const t of e.splice(0,e.length))t()})}Object.assign(n,n()),t.evtbus=n,t.default=n,t.withSubscribe=e,t.bindSubscriptions=o,Object.defineProperty(t,"__esModule",{value:!0})});
