define(["exports"],function(t){"use strict";function n(){function t(t){return{emit(e,o){const i=n(t),s=i[e],c=i["*"];if(s)for(const n of s)n(o,t);if(c)for(const n of c)n(o,e,t)},clear(n){const e=i.get(t);e&&(n&&i.delete(t),o(e))}}}function n(t,n){if(null==t)throw new TypeError("Invalid topic");let o=i.get(t);if(void 0===o){const n=s.get(t);void 0!==n?o=n.ns||(n.ns=e()):i.set(t,o=e())}return n?o[n]||(o[n]=[]):o}function e(){return Object.create(null)}function o(t){for(const[n,e]of Object.entries(t)){delete t[n];for(const t of e)t.fn=t.lst=null}}const i=new Map,s=new WeakMap;return{topic:t,sink:function(e){function i(t,o,c){if("function"!=typeof c)throw new TypeError("Expected function");let r=s.get(e);if(void 0===r&&(r=new Set,s.set(e,r)),t){const e=n(t,o);r.add({fn:c,lst:e}),e.push(c)}return i}return Object.assign(i,{subscribe:i,clear:function(){const t=s.get(e);if(t){s.delete(e);for(const{lst:n,fn:e}of t)n&&n.splice(n.indexOf(e)>>>0,1);t.clear(),t.ns&&o(t.ns)}return i},on:function(t,n){return i(e,t,n)},emit:function(n,o){const c=s.get(e);return c&&c.ns&&t(e).emit(n,o),i}})}}}function e(t,n){null==t.state&&(t.state={});const e=[];t.evt_sink.on("will_mount",function(){const o=n?n.call(t,t.props,t):t.subscribe(t.props);t.setState(o,function(){for(const[n,i]of Object.entries(o)){if(null==i||"function"!=typeof i.subscribe)throw new TypeError(`Subscription "${n}" does not have a subscribe() function`);e.push(i.subscribe(!1,e=>{t.setState(t=>e!==t[n]?{[n]:e}:null)}))}})}).on("will_unmount",function(){for(const t of e.splice(0,e.length))t()})}Object.assign(n,n()),t.default=n,t.withSubscribe=function(t,n){const o={};for(const[i,s]of Object.entries(n))o[i]=class extends s{subscribe(t){}componentWillMount(){super.componentWillMount(),e(this),this.evt_sink.emit("will_mount")}componentDidMount(){this.evt_sink.emit("did_mount")}componentWillUnmount(){this.evt_sink.emit("will_unmount").clear()}get evt_sink(){return t.sink(this)}},o[i].prototype.evtbus=t;return o},t.bindSubscriptions=e,Object.defineProperty(t,"__esModule",{value:!0})});
